<!DOCTYPE html>
<html>
<head>
    <title>Keycloak Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Keycloak Connection Test</h1>
    <p>Keycloak URL: <strong>http://gateway.ymorozov.ru/keycloak</strong></p>

    <button onclick="testKeycloak()">Test Login (admin/admin123)</button>

    <div id="result" class="result"></div>

    <script>
        async function testKeycloak() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            resultDiv.className = 'result';

            const tokenUrl = 'http://gateway.ymorozov.ru/keycloak/realms/api-gateway/protocol/openid-connect/token';

            const params = new URLSearchParams({
                grant_type: 'password',
                client_id: 'gateway-admin-ui',
                username: 'admin',
                password: 'admin123',
                scope: 'openid profile email'
            });

            try {
                console.log('Sending request to:', tokenUrl);

                const response = await fetch(tokenUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: params.toString()
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);

                if (!response.ok) {
                    const error = await response.json().catch(() => ({
                        error: 'unknown',
                        error_description: 'Failed to parse error response'
                    }));

                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <strong>❌ Error ${response.status}</strong><br>
                        ${error.error}: ${error.error_description}
                    `;
                    return;
                }

                const data = await response.json();
                console.log('Success! Token received:', data);

                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>✅ Success!</strong><br>
                    Access Token (first 50 chars): ${data.access_token.substring(0, 50)}...<br>
                    Expires in: ${data.expires_in} seconds<br>
                    Token type: ${data.token_type}
                `;

            } catch (error) {
                console.error('Request failed:', error);

                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>❌ Request Failed</strong><br>
                    Error: ${error.message}<br>
                    ${error.name === 'TypeError' ? 'This is likely a CORS or network error' : ''}
                `;
            }
        }
    </script>
</body>
</html>
