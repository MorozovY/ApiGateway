# üìã Sprint Change Proposal ‚Äî Epic 12 Auth Cleanup

**–î–∞—Ç–∞:** 2026-02-25
**–ê–≤—Ç–æ—Ä:** Bob (Scrum Master)
**–ü—Ä–æ–µ–∫—Ç:** ApiGateway
**Scope:** –£–¥–∞–ª–µ–Ω–∏–µ legacy cookie auth –ø–µ—Ä–µ–¥ Story 12.10

---

## 1. –†–µ–∑—é–º–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Å–∏—Å—Ç–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (legacy cookie-based + Keycloak) —á–µ—Ä–µ–∑ feature flag —Å–æ–∑–¥–∞—ë—Ç —Ç–µ—Ö–¥–æ–ª–≥ –∏ –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É:

- **300+ —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** –≤ `AuthContext.tsx` (2 AuthProvider)
- **–£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞** –≤ –∫–∞–∂–¥–æ–º auth-–∑–∞–≤–∏—Å–∏–º–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Äî –Ω—É–∂–Ω–æ –ø–æ–∫—Ä—ã–≤–∞—Ç—å –æ–±–∞ –ø—É—Ç–∏
- **–†–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏** –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö auth –∫–æ–¥–∞

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è

- **Trigger:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ Story 12.10 (E2E Playwright Tests)
- **–ö–æ–≥–¥–∞:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ 12.10
- **Evidence:** Code review `frontend/admin-ui/src/features/auth/context/AuthContext.tsx` ‚Äî –¥–≤–∞ –ø–æ–ª–Ω—ã—Ö AuthProvider (—Å—Ç—Ä–æ–∫–∏ 41-139 –∏ 196-394)
- **–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:** –ù–ï –≤ production, –ø–æ–ª–Ω—ã–π E2E test ‚Äî –≤ 12.10

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–ü–æ—Å–ª–µ Story 12.2 incident (–ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö) –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω **PA-08: Non-Breaking Changes** —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º feature flag –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏. Keycloak auth —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (Stories 12.1-12.9 done), –Ω–æ legacy –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è fallback. –¢–µ–ø–µ—Ä—å —ç—Ç–æ—Ç fallback –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω –∏ —Å–æ–∑–¥–∞—ë—Ç –ø—É—Ç–∞–Ω–∏—Ü—É.

---

## 2. –ê–Ω–∞–ª–∏–∑ impact

### ‚úÖ Epic Impact: –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô

| Epic | –°—Ç–∞—Ç—É—Å | Impact | –î–µ–π—Å—Ç–≤–∏–µ |
|------|--------|--------|----------|
| **Epic 12** | in-progress | ‚úÖ –î–æ–±–∞–≤–∏—Ç—å Story 12.9.1 –ø–µ—Ä–µ–¥ 12.10 | –í—Å—Ç–∞–≤–∏—Ç—å cleanup story |
| –ë—É–¥—É—â–∏–µ Epics | backlog | ‚úÖ –ë–µ–∑ impact | –ù–µ—Ç |

**Rationale:** Epic 12 —Ü–µ–ª—å ‚Äî "Keycloak Integration" ‚Äî –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ (12.1-12.9). Cleanup legacy auth ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à–∞–≥ –ø–µ—Ä–µ–¥ E2E.

### ‚úÖ Story Impact: +1 STORY

**–ù–æ–≤–∞—è Story:**

**Story 12.9.1:** Remove Legacy Cookie Auth
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** HIGH (–±–ª–æ–∫–∏—Ä—É–µ—Ç 12.10)
**Effort:** Small (2-3 —á–∞—Å–∞, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–µ)

**Acceptance Criteria:**
- AC1: `CookieAuthProvider` –∫–æ–¥ —É–¥–∞–ª—ë–Ω –∏–∑ `AuthContext.tsx`
- AC2: `VITE_USE_KEYCLOAK` default = `true` (–∏–ª–∏ —É–¥–∞–ª—ë–Ω env var)
- AC3: Feature flag logic —É–¥–∞–ª–µ–Ω–∞ –∏–∑ `isKeycloakEnabled()`
- AC4: Cookie-based auth —Ç–µ—Å—Ç—ã —É–¥–∞–ª–µ–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
- AC5: Backend `/api/v1/auth/login` endpoint —É–¥–∞–ª—ë–Ω (–µ—Å–ª–∏ cookie-only)
- AC6: Smoke test: login —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Keycloak

**–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π Sprint Status:**
```yaml
epic-12: in-progress
12-9: done
12-9-1-remove-legacy-cookie-auth: backlog  # ‚Üê –ù–û–í–ê–Ø
12-10-e2e-playwright-tests: backlog
```

### ‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤: –¢–û–õ–¨–ö–û –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

| –ê—Ä—Ç–µ—Ñ–∞–∫—Ç | Impact | –¢—Ä–µ–±—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è |
|----------|--------|---------------------|
| **PRD** | ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ | –ù–µ—Ç (PRD Phase 2 —Ç—Ä–µ–±—É–µ—Ç Keycloak) |
| **Architecture** | ‚ö†Ô∏è –ú–∏–Ω–æ—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ legacy auth –≤ —Å–µ–∫—Ü–∏–∏ "Admin UI Keycloak Integration" |
| **UX Design** | ‚úÖ –ë–µ–∑ impact | –ù–µ—Ç (UX –Ω–µ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä—É–µ—Ç auth implementation) |
| **Docker Compose** | ‚ö†Ô∏è –ú–∏–Ω–æ—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | `.env.example`: —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `VITE_USE_KEYCLOAK=true` |
| **Tests** | ‚ö†Ô∏è –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å | –£–¥–∞–ª–∏—Ç—å cookie auth —Ç–µ—Å—Ç—ã, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Keycloak —Ç–µ—Å—Ç—ã |

### üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π impact

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ (–æ—Ü–µ–Ω–∫–∞):**

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ | –°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ | –¢–∏–ø |
|------|---------------|-----------------|------|
| `AuthContext.tsx` | ~150 | ~5 | –£–¥–∞–ª–µ–Ω–∏–µ + —É–ø—Ä–æ—â–µ–Ω–∏–µ |
| `oidcConfig.ts` | ~10 | 0 | –£–¥–∞–ª–∏—Ç—å feature flag |
| `.env.example` | ~3 | ~1 | –û–±–Ω–æ–≤–∏—Ç—å default |
| `authApi.ts` | ~30 | 0 | –£–¥–∞–ª–∏—Ç—å legacy API –≤—ã–∑–æ–≤—ã |
| Backend `/auth/*` (–µ—Å–ª–∏ cookie-only) | ~50 | 0 | –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å |
| **–ò—Ç–æ–≥–æ** | **~240** | **~5** | **–ù–µ—Ç—Ç–æ -235 —Å—Ç—Ä–æ–∫** |

**–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤:**

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|-----------|
| Keycloak –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ cleanup | LOW | Smoke test –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è |
| –ó–∞–±—ã–ª–∏ —É–¥–∞–ª–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | LOW | Code review checklist |
| Backend API –≤—Å—ë –µ—â—ë –æ–∂–∏–¥–∞–µ—Ç cookies | MEDIUM | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend auth –≤ 12.9.1 |

---

## 3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥

### ‚úÖ **–í—ã–±—Ä–∞–Ω–Ω—ã–π –ø—É—Ç—å: Direct Adjustment (–ø—Ä—è–º–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞)**

**–ü–æ–¥—Ö–æ–¥:** –î–æ–±–∞–≤–∏—Ç—å Story 12.9.1 (Remove Legacy Auth) –ø–µ—Ä–µ–¥ 12.10.

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
1. ‚úÖ **–ù–∏–∑–∫–∏–π effort** ‚Äî –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–¥–∞
2. ‚úÖ **–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –≤ production
3. ‚úÖ **–£–ø—Ä–æ—â–∞–µ—Ç 12.10** ‚Äî E2E —Ç–µ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è Keycloak –ø—É—Ç–∏
4. ‚úÖ **–£—Å—Ç—Ä–∞–Ω—è–µ—Ç —Ç–µ—Ö–¥–æ–ª–≥** ‚Äî —É–±–∏—Ä–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É

**–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**

| –û–ø—Ü–∏—è | –í–µ—Ä–¥–∏–∫—Ç | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-------|---------|-------------|
| **–í–∞—Ä–∏–∞–Ω—Ç 1: Direct Adjustment** | ‚úÖ **–í–´–ë–†–ê–ù** | –õ—É—á—à–∏–π –±–∞–ª–∞–Ω—Å effort/benefit |
| **–í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–∫–∞—Ç–∏—Ç—å Keycloak** | ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç | Keycloak —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–µ—Ç –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å |
| **–í–∞—Ä–∏–∞–Ω—Ç 3: –û—Å—Ç–∞–≤–∏—Ç—å –æ–±–µ —Å–∏—Å—Ç–µ–º—ã** | ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç | –¢–µ—Ö–¥–æ–ª–≥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞—Å—Ç–∏ |

---

## 4. –î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### üìù **–ò–∑–º–µ–Ω–µ–Ω–∏–µ #1: –£–¥–∞–ª–∏—Ç—å CookieAuthProvider**

**–§–∞–π–ª:** `frontend/admin-ui/src/features/auth/context/AuthContext.tsx`

**–ë–´–õ–û (—Å—Ç—Ä–æ–∫–∏ 34-139):**
```typescript
// ========================================
// COOKIE-BASED AUTH PROVIDER (Legacy)
// ========================================

/**
 * Cookie-based AuthProvider (Legacy).
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ VITE_USE_KEYCLOAK=false.
 */
function CookieAuthProvider({ children }: AuthProviderProps) {
  // ... 100+ —Å—Ç—Ä–æ–∫ cookie auth logic
}
```

**–°–¢–ê–õ–û:**
```typescript
// –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** Legacy auth –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, Keycloak ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É—Ç—å.

---

### üìù **–ò–∑–º–µ–Ω–µ–Ω–∏–µ #2: –£–ø—Ä–æ—Å—Ç–∏—Ç—å Main AuthProvider**

**–§–∞–π–ª:** `frontend/admin-ui/src/features/auth/context/AuthContext.tsx`

**–ë–´–õ–û (—Å—Ç—Ä–æ–∫–∏ 396-413):**
```typescript
// ========================================
// MAIN AUTH PROVIDER WITH FEATURE FLAG
// ========================================

/**
 * AuthProvider —Å feature flag –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É cookie-auth –∏ Keycloak.
 */
export function AuthProvider({ children }: AuthProviderProps) {
  if (isKeycloakEnabled()) {
    return <KeycloakDirectGrantsProvider>{children}</KeycloakDirectGrantsProvider>
  }

  return <CookieAuthProvider>{children}</CookieAuthProvider>
}
```

**–°–¢–ê–õ–û:**
```typescript
/**
 * AuthProvider ‚Äî Keycloak Direct Access Grants.
 * Story 12.9.1: Legacy cookie auth —É–¥–∞–ª—ë–Ω.
 */
export function AuthProvider({ children }: AuthProviderProps) {
  return <KeycloakDirectGrantsProvider>{children}</KeycloakDirectGrantsProvider>
}
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –£–±—Ä–∞—Ç—å feature flag logic, –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Keycloak.

---

### üìù **–ò–∑–º–µ–Ω–µ–Ω–∏–µ #3: –£–¥–∞–ª–∏—Ç—å Feature Flag Helper**

**–§–∞–π–ª:** `frontend/admin-ui/src/features/auth/config/oidcConfig.ts`

**–ë–´–õ–û:**
```typescript
export function isKeycloakEnabled(): boolean {
  return import.meta.env.VITE_USE_KEYCLOAK === 'true'
}
```

**–°–¢–ê–õ–û:**
```typescript
// –£–¥–∞–ª–µ–Ω–æ ‚Äî Keycloak –≤—Å–µ–≥–¥–∞ enabled
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** Feature flag –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω.

---

### üìù **–ò–∑–º–µ–Ω–µ–Ω–∏–µ #4: –û–±–Ω–æ–≤–∏—Ç—å Environment Example**

**–§–∞–π–ª:** `frontend/admin-ui/.env.example`

**–ë–´–õ–û:**
```bash
# Feature flag –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É cookie-auth –∏ Keycloak OIDC
# false = –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π cookie-based auth (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
# true = –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Keycloak OIDC auth
VITE_USE_KEYCLOAK=false
```

**–°–¢–ê–õ–û:**
```bash
# –£–¥–∞–ª–µ–Ω–æ ‚Äî Keycloak –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ (Story 12.9.1)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –£–±—Ä–∞—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ legacy auth –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

---

### üìù **–ò–∑–º–µ–Ω–µ–Ω–∏–µ #5: –£–¥–∞–ª–∏—Ç—å Legacy Auth API**

**–§–∞–π–ª:** `frontend/admin-ui/src/features/auth/api/authApi.ts`

**–î–µ–π—Å—Ç–≤–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è cookie auth
- –£–¥–∞–ª–∏—Ç—å `loginApi()`, `logoutApi()`, `checkSessionApi()` –µ—Å–ª–∏ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å cookies
- –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Keycloak API –≤—ã–∑–æ–≤—ã

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** Cleanup –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö API –º–µ—Ç–æ–¥–æ–≤.

---

### üìù **–ò–∑–º–µ–Ω–µ–Ω–∏–µ #6: Backend Auth Endpoints (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)**

**–§–∞–π–ª:** `backend/gateway-admin/src/main/kotlin/.../controller/AuthController.kt`

**–î–µ–π—Å—Ç–≤–∏–µ:**
- ‚ö†Ô∏è **–ò–°–°–õ–ï–î–û–í–ê–¢–¨:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ cookie-only endpoints (`/api/v1/auth/login`, `/api/v1/auth/logout`, `/api/v1/auth/session`)
- –ï—Å–ª–∏ –æ–Ω–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å Keycloak JWT ‚Äî —É–¥–∞–ª–∏—Ç—å
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT —Å–µ—Å—Å–∏–∏ ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –£–±—Ä–∞—Ç—å –º—ë—Ä—Ç–≤—ã–π backend –∫–æ–¥.

---

### üìù **–ò–∑–º–µ–Ω–µ–Ω–∏–µ #7: –û–±–Ω–æ–≤–∏—Ç—å Architecture Doc**

**–§–∞–π–ª:** `_bmad-output/planning-artifacts/architecture.md`

**–°–µ–∫—Ü–∏—è:** "Admin UI Keycloak Integration" (—Å—Ç—Ä–æ–∫–∏ ~2016-2118)

**–î–û–ë–ê–í–ò–¢–¨ –ó–ê–ú–ï–¢–ö–£:**
```markdown
**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ (Story 12.9.1):** Legacy cookie-based authentication —É–¥–∞–ª–µ–Ω–∞. Keycloak Direct Access Grants ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Admin UI.
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ legacy auth.

---

## 5. Implementation Handoff

### –ú–∞—Å—à—Ç–∞–± –∏–∑–º–µ–Ω–µ–Ω–∏–π: **MINOR** ‚úÖ

**–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:** –ü—Ä—è–º–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

**–ü–æ–ª—É—á–∞—Ç–µ–ª–∏ handoff:**
- **Charlie (Senior Dev)** ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Story 12.9.1
- **Bob (Scrum Master)** ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `sprint-status.yaml` + Architecture doc

### –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

| –†–æ–ª—å | –ó–∞–¥–∞—á–∏ |
|------|--------|
| **Charlie (Dev)** | - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Story 12.9.1 (—É–¥–∞–ª–µ–Ω–∏–µ legacy auth)<br>- Smoke test –ø–æ—Å–ª–µ cleanup<br>- –°–æ–∑–¥–∞—Ç—å git commit |
| **Bob (SM)** | - –û–±–Ω–æ–≤–∏—Ç—å `sprint-status.yaml` ‚úÖ DONE<br>- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –≤ Architecture doc (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)<br>- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Story 12.10 —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ |

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ **Story 12.9.1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∫–æ–≥–¥–∞:**
1. `CookieAuthProvider` –∫–æ–¥ —É–¥–∞–ª—ë–Ω
2. Feature flag logic —É–¥–∞–ª–µ–Ω–∞
3. `.env.example` –æ–±–Ω–æ–≤–ª—ë–Ω
4. Smoke test –ø—Ä–æ–π–¥–µ–Ω (login —á–µ—Ä–µ–∑ Keycloak —Ä–∞–±–æ—Ç–∞–µ—Ç)
5. –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è Keycloak auth —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
6. Git commit —Å–æ–∑–¥–∞–Ω: `fix(12.9.1): remove legacy cookie auth`

‚úÖ **Epic 12 –≥–æ—Ç–æ–≤ –¥–ª—è 12.10 –∫–æ–≥–¥–∞:**
- Story 12.9.1 –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ `done` –≤ sprint-status.yaml
- E2E —Ç–µ—Å—Ç—ã (12.10) –º–æ–≥—É—Ç –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—Ç—å —Ç–æ–ª—å–∫–æ Keycloak –ø—É—Ç—å

---

## 6. Timeline & Effort

| –ó–∞–¥–∞—á–∞ | –í–ª–∞–¥–µ–ª–µ—Ü | Effort | Timing |
|--------|----------|--------|--------|
| Story 12.9.1 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | Charlie | 2-3 —á–∞—Å–∞ | –°–µ–≥–æ–¥–Ω—è |
| Smoke test | Charlie | 30 –º–∏–Ω | –ü–æ—Å–ª–µ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | Bob | 15 –º–∏–Ω | –ü–æ—Å–ª–µ 12.9.1 done |
| **–ò—Ç–æ–≥–æ** | ‚Äî | **~3 —á–∞—Å–∞** | **1 —Å–µ—Å—Å–∏—è** |

**–ù–µ—Ç impact –Ω–∞ Epic 12 timeline** ‚Äî Story 12.9.1 –º–µ–Ω—å—à–µ —á–µ–º 12.10, –æ–±—â–∏–π effort –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è.

---

## 7. –†–µ—à–µ–Ω–∏–µ –æ–± Approval

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–£–¢–í–ï–†–ñ–î–ï–ù–û Yury (2026-02-25)**

**–†–µ—à–µ–Ω–∏—è:**
1. **‚úÖ Story 12.9.1 —Å–æ–∑–¥–∞–Ω–∞** ‚Äî Yury –∑–∞–ø—É—Å—Ç–∏—Ç –µ—ë –≤ —Ä–∞–±–æ—Ç—É —Å–∞–º
2. **Backend cleanup** ‚Äî –≤—ã—è–≤–∏–º –Ω–∞ —Ç–µ—Å—Ç–∞—Ö (–≤–æ –≤—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
3. **Timing** ‚Äî —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è –ø–µ—Ä–µ–¥ 12.10

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

**Frontend (Admin UI):**
- `src/features/auth/context/AuthContext.tsx` ‚úÇÔ∏è –£–î–ê–õ–ò–¢–¨ ~150 —Å—Ç—Ä–æ–∫
- `src/features/auth/config/oidcConfig.ts` ‚úÇÔ∏è –£–î–ê–õ–ò–¢–¨ feature flag
- `src/features/auth/api/authApi.ts` ‚úÇÔ∏è –£–î–ê–õ–ò–¢–¨ legacy API –≤—ã–∑–æ–≤—ã
- `.env.example` üìù –û–ë–ù–û–í–ò–¢–¨ —É–¥–∞–ª–∏—Ç—å VITE_USE_KEYCLOAK

**Backend (Gateway Admin):**
- `src/main/kotlin/.../controller/AuthController.kt` ‚ùì –ò–°–°–õ–ï–î–û–í–ê–¢–¨ cookie endpoints (–≤—ã—è–≤–∏–º –Ω–∞ —Ç–µ—Å—Ç–∞—Ö)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `_bmad-output/planning-artifacts/architecture.md` üìù –î–û–ë–ê–í–ò–¢–¨ –∑–∞–º–µ—Ç–∫—É –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `_bmad-output/implementation-artifacts/sprint-status.yaml` ‚úÖ DONE ‚Äî Story 12.9.1 –¥–æ–±–∞–≤–ª–µ–Ω–∞

---

**Workflow Complete ‚Äî Story 12.9.1 –≥–æ—Ç–æ–≤–∞ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üéØ

*Change Proposal –∑–∞–≤–µ—Ä—à—ë–Ω: Bob (Scrum Master) ‚Äî 2026-02-25*
